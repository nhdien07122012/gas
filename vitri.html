<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quáº£n lÃ½ vá»‹ trÃ­ Ä‘iá»ƒm gas</title>
  <link rel="icon" type="image/png" href="icon.png">
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 30px auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); padding: 30px; }
    h1 { color: #2c80ff; margin-bottom: 20px; }
    .search-group { display: flex; gap: 10px; margin-bottom: 20px; }
    input { padding: 12px; border-radius: 8px; border: 1px solid #dee2e6; font-size: 1rem; flex: 1; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 12px 8px; border-bottom: 1px solid #dee2e6; text-align: left; }
    th { background: #f8f9fa; }
    tr:hover { background: #f1f3f5; }
    .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: 600; background: #34c759; color: white; }
    .map-link { color: #2c80ff; text-decoration: underline; cursor: pointer; }
    @media (max-width: 600px) { .container { padding: 10px; } th, td { font-size: 0.95rem; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ Quáº£n lÃ½ vá»‹ trÃ­ Ä‘iá»ƒm gas</h1>
    <div class="search-group">
      <input id="search" placeholder="TÃ¬m kiáº¿m tÃªn Ä‘iá»ƒm, Ä‘á»‹a chá»‰ hoáº·c ghi chÃº...">
    </div>
    <table id="vitri-table">
      <thead>
        <tr>
          <th>TÃªn Ä‘iá»ƒm</th>
          <th>Äá»‹a chá»‰</th>
          <th>Ghi chÃº</th>
          <th>Tá»a Ä‘á»™</th>
          <th>Báº£n Ä‘á»“</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="empty-state" style="text-align:center;color:#888;margin:30px 0;display:none;">
      <h3>ğŸ“­ ChÆ°a cÃ³ vá»‹ trÃ­ nÃ o Ä‘Æ°á»£c lÆ°u</h3>
      <p>HÃ£y sá»­ dá»¥ng chá»©c nÄƒng lÆ°u vá»‹ trÃ­ trÃªn trang chÃ­nh Ä‘á»ƒ báº¯t Ä‘áº§u.</p>
    </div>
  </div>
  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyRnnoEd2BnD7u1pXHER17Cv95BN9Z77yUeO6oR7CFRtbUqd-SiVJqBv5ENYyARwX77fw/exec';
    let allData = [];
    let vitriData = [];
    // TrÃ­ch xuáº¥t tá»a Ä‘á»™ tá»« ghi chÃº
    function extractGPS(note) {
      const match = note.match(/\[GPS: ([\d.]+), ([\d.]+)\]/);
      if (match) return { lat: match[1], lng: match[2] };
      return null;
    }
    function displayVitri(data) {
      const tbody = document.querySelector('#vitri-table tbody');
      tbody.innerHTML = '';
      let count = 0;
      data.forEach(row => {
        const gps = extractGPS(row.ghi_chu || '');
        if (!gps) return;
        count++;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.ten_diem}</td>
          <td>${row.dia_chi}</td>
          <td>${row.ghi_chu}</td>
          <td><span class="badge">${gps.lat}, ${gps.lng}</span></td>
          <td><a class="map-link" href="https://maps.google.com/?q=${gps.lat},${gps.lng}" target="_blank">Xem báº£n Ä‘á»“</a></td>
        `;
        tbody.appendChild(tr);
      });
      document.getElementById('empty-state').style.display = count === 0 ? 'block' : 'none';
    }
    function filterVitri() {
      const q = document.getElementById('search').value.toLowerCase();
      const filtered = vitriData.filter(row => {
        return (row.ten_diem && row.ten_diem.toLowerCase().includes(q)) ||
               (row.dia_chi && row.dia_chi.toLowerCase().includes(q)) ||
               (row.ghi_chu && row.ghi_chu.toLowerCase().includes(q));
      });
      displayVitri(filtered);
    }
    async function taiDuLieu() {
      try {
        const res = await fetch(scriptURL);
        allData = await res.json();
        vitriData = allData.filter(row => extractGPS(row.ghi_chu || ''));
        displayVitri(vitriData);
      } catch (e) {
        document.getElementById('empty-state').style.display = 'block';
      }
    }
    document.getElementById('search').addEventListener('input', filterVitri);
    taiDuLieu();
  </script>
</body>
</html>
