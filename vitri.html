<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω v·ªã tr√≠ ƒëi·ªÉm gas</title>
<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<link rel="apple-touch-icon-precomposed" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Qu·∫£n l√Ω v·ªã tr√≠">

<style>
  /* ========== CSS VARIABLES FOR LIGHT MODE ========== */
  :root {
    /* M√†u s·∫Øc c∆° b·∫£n */
    --primary: #2c80ff;
    --primary-dark: #1a6de0;
    --primary-light: #5a9dff;
    --secondary: #34c759;
    --secondary-dark: #2aa64a;
    --danger: #ff3b30;
    --danger-dark: #e0352b;
    --warning: #ff9500;
    --warning-dark: #e08900;
    --info: #5ac8fa;
    --success: #34c759;
    
    /* M√†u n·ªÅn v√† vƒÉn b·∫£n Light Mode */
    --bg-primary: #ffffff;
    --bg-secondary: #f5f7fa;
    --bg-tertiary: #f8f9fa;
    --bg-card: #ffffff;
    --bg-sidebar: #ffffff;
    --bg-modal: #ffffff;
    --bg-input: #ffffff;
    --bg-hover: #f8fafc;
    --bg-active: #e8f0fe;
    
    /* M√†u vƒÉn b·∫£n Light Mode */
    --text-primary: #333333;
    --text-secondary: #6c757d;
    --text-tertiary: #868e96;
    --text-inverse: #ffffff;
    --text-muted: #adb5bd;
    
    /* M√†u vi·ªÅn v√† b√≥ng */
    --border-color: #dee2e6;
    --border-light: #e9ecef;
    --border-dark: #ced4da;
    --shadow: 0 2px 10px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 25px rgba(0,0,0,0.12);
    --shadow-dark: 0 2px 10px rgba(0,0,0,0.15);
    
    /* Border radius */
    --radius-xl: 28px;
    --radius-lg: 20px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --radius-xs: 8px;
    --radius-circle: 50%;
    
    /* K√≠ch th∆∞·ªõc */
    --sidebar-width: 280px;
    --header-height: auto;
    
    /* Hi·ªáu ·ª©ng chuy·ªÉn ti·∫øp */
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: all 0.15s ease;
    --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* ƒê·ªô trong su·ªët */
    --opacity-disabled: 0.6;
    --opacity-hover: 0.9;
    --opacity-active: 0.8;
  }
  
  /* ========== DARK MODE VARIABLES ========== */
  @media (prefers-color-scheme: dark) {
    :root {
      /* M√†u s·∫Øc c∆° b·∫£n */
      --primary: #3d8eff;
      --primary-dark: #2c7de6;
      --primary-light: #5a9dff;
      --secondary: #30c75a;
      --secondary-dark: #26a64a;
      --danger: #ff5252;
      --danger-dark: #ff3838;
      --warning: #ffa726;
      --warning-dark: #ff9800;
      --info: #42a5f5;
      --success: #30c75a;
      
      /* M√†u n·ªÅn v√† vƒÉn b·∫£n Dark Mode */
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --bg-tertiary: #2d2d2d;
      --bg-card: #1e1e1e;
      --bg-sidebar: #1e1e1e;
      --bg-modal: #252525;
      --bg-input: #2d2d2d;
      --bg-hover: #2a2a2a;
      --bg-active: #2c3e50;
      
      /* M√†u vƒÉn b·∫£n Dark Mode */
      --text-primary: #f5f5f5;
      --text-secondary: #b0b0b0;
      --text-tertiary: #8a8a8a;
      --text-inverse: #121212;
      --text-muted: #666666;
      
      /* M√†u vi·ªÅn v√† b√≥ng Dark Mode */
      --border-color: #3a3a3a;
      --border-light: #4a4a4a;
      --border-dark: #555555;
      --shadow: 0 2px 10px rgba(0,0,0,0.3);
      --shadow-lg: 0 8px 25px rgba(0,0,0,0.4);
      --shadow-dark: 0 2px 10px rgba(0,0,0,0.5);
    }
    
    /* ƒê·∫£m b·∫£o c√°c ph·∫ßn t·ª≠ ch√≠nh c√≥ ch·ªØ tr·∫Øng */
    h1, h2, h3, h4 {
      color: var(--text-primary) !important;
    }
    
    /* ƒê·∫£m b·∫£o link c√≥ m√†u tr·∫Øng */
    .back-button {
      color: var(--text-inverse) !important;
    }
    
    /* ƒêi·ªÅu ch·ªânh m√†u placeholder */
    input::placeholder {
      color: var(--text-muted);
    }
  }
  
  /* ========== CSS RESET & BASE STYLES ========== */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html {
    font-size: 16px;
    transition: background-color 0.5s ease;
  }
  
  body {
    font-family: 'Segoe UI', 'Inter', 'SF Pro Text', -apple-system, BlinkMacSystemFont, Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    line-height: 1.6;
    padding: 20px;
    min-height: 100vh;
    transition: var(--transition-slow);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* ========== MAIN CONTAINER ========== */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    transition: var(--transition);
    border: 1px solid var(--border-color);
    padding: 30px;
  }
  
  /* ========== HEADER ========== */
  h1 {
    color: var(--primary);
    margin-bottom: 20px;
    font-size: 2rem;
    text-align: center;
    transition: var(--transition);
  }
  
  /* ========== SEARCH BAR ========== */
  .search-group {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  
  input {
    padding: 14px 16px;
    border-radius: var(--radius-md);
    border: 1.5px solid var(--border-color);
    font-size: 1rem;
    flex: 1;
    transition: var(--transition);
    background: var(--bg-input);
    color: var(--text-primary);
    min-width: 0;
  }
  
  input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(61, 142, 255, 0.2);
    background: var(--bg-input);
  }
  
  input::placeholder {
    color: var(--text-muted);
  }
  
  /* ========== TABLE STYLES ========== */
  .table-container {
    overflow-x: auto;
    margin-top: 10px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    background: var(--bg-card);
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0;
    min-width: 600px;
  }
  
  th {
    background-color: var(--bg-tertiary);
    padding: 16px 12px;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border-color);
  }
  
  td {
    padding: 14px 12px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
    vertical-align: middle;
  }
  
  tr:last-child td {
    border-bottom: none;
  }
  
  tr:hover {
    background-color: var(--bg-hover);
  }
  
  /* ========== BADGE STYLES ========== */
  .badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: var(--radius-xs);
    font-size: 0.85rem;
    font-weight: 600;
    background: var(--secondary);
    color: var(--text-inverse);
    border: 1px solid var(--secondary-dark);
    transition: var(--transition-fast);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
  }
  
  .badge:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(52, 199, 89, 0.3);
  }
  
  /* ========== MAP LINK BUTTON ========== */
  .map-link {
    background: var(--primary);
    color: var(--text-inverse) !important;
    text-decoration: none;
    cursor: pointer;
    font-weight: 600;
    border-radius: var(--radius-sm);
    padding: 8px 16px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    box-shadow: var(--shadow);
    transition: var(--transition);
    border: 1px solid var(--primary-dark);
    min-width: 60px;
  }
  
  .map-link:hover {
    background: var(--primary-dark);
    box-shadow: 0 4px 16px rgba(44, 128, 255, 0.18);
    transform: translateY(-2px);
  }
  
  /* ========== EMPTY STATE ========== */
  #empty-state {
    text-align: center;
    color: var(--text-secondary);
    margin: 30px 0;
    display: none;
    padding: 40px 20px;
    border-radius: var(--radius-md);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
  }
  
  #empty-state h3 {
    margin-bottom: 10px;
    font-size: 1.2rem;
    color: var(--text-primary);
  }
  
  #empty-state p {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
  }
  
  /* ========== BACK BUTTON ========== */
  .back-button {
    position: fixed;
    right: 30px;
    bottom: 30px;
    z-index: 999;
    background: var(--primary);
    color: var(--text-inverse);
    border: none;
    border-radius: var(--radius-circle);
    width: 56px;
    height: 56px;
    box-shadow: var(--shadow-lg);
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    border: 2px solid var(--primary-dark);
  }
  
  .back-button:hover {
    background: var(--primary-dark);
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 10px 20px rgba(44, 128, 255, 0.3);
  }
  
  /* ========== SCROLLBAR STYLING ========== */
  ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }
  
  ::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--border-dark);
    border-radius: var(--radius-sm);
    border: 2px solid var(--bg-tertiary);
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
  }
  
  /* Firefox scrollbar */
  * {
    scrollbar-width: thin;
    scrollbar-color: var(--border-dark) var(--bg-tertiary);
  }
  
  /* ========== ANIMATIONS ========== */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .fade-in {
    animation: fadeIn 0.4s ease-out;
  }
  
  /* ========== RESPONSIVE STYLES ========== */
  @media (max-width: 768px) {
    body {
      padding: 15px;
    }
    
    .container {
      padding: 20px;
      border-radius: var(--radius-lg);
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 15px;
    }
    
    .search-group {
      flex-direction: column;
      gap: 8px;
    }
    
    input {
      padding: 12px 14px;
      font-size: 1rem;
      border-radius: var(--radius-sm);
      width: 100%;
    }
    
    .table-container {
      border-radius: var(--radius-sm);
    }
    
    table {
      min-width: 500px;
    }
    
    th, td {
      padding: 12px 8px;
      font-size: 0.9rem;
    }
    
    .badge {
      padding: 5px 10px;
      font-size: 0.8rem;
      max-width: 150px;
    }
    
    .map-link {
      padding: 6px 12px;
      font-size: 0.9rem;
    }
    
    #empty-state {
      padding: 30px 15px;
      margin: 20px 0;
    }
    
    .back-button {
      right: 20px;
      bottom: 20px;
      width: 50px;
      height: 50px;
      font-size: 1.6rem;
    }
  }
  
  @media (max-width: 480px) {
    body {
      padding: 10px;
    }
    
    .container {
      padding: 15px;
      border-radius: var(--radius-md);
    }
    
    h1 {
      font-size: 1.6rem;
      margin-bottom: 12px;
    }
    
    input {
      padding: 10px 12px;
      font-size: 0.95rem;
      border-radius: var(--radius-xs);
    }
    
    table {
      min-width: 400px;
    }
    
    th, td {
      padding: 10px 6px;
      font-size: 0.85rem;
    }
    
    .badge {
      padding: 4px 8px;
      font-size: 0.75rem;
      max-width: 120px;
    }
    
    .map-link {
      padding: 5px 10px;
      font-size: 0.85rem;
      min-width: 50px;
    }
    
    #empty-state {
      padding: 20px 10px;
      margin: 15px 0;
    }
    
    #empty-state h3 {
      font-size: 1.1rem;
    }
    
    #empty-state p {
      font-size: 0.9rem;
    }
    
    .back-button {
      right: 15px;
      bottom: 15px;
      width: 45px;
      height: 45px;
      font-size: 1.4rem;
    }
  }
  
  /* ========== DARK MODE SPECIFIC ADJUSTMENTS ========== */
  @media (prefers-color-scheme: dark) {
    /* ƒêi·ªÅu ch·ªânh ƒë·ªô t∆∞∆°ng ph·∫£n cho c√°c ph·∫ßn t·ª≠ ƒë·∫∑c bi·ªát */
    .table-container {
      border-color: var(--border-dark);
    }
    
    /* ƒêi·ªÅu ch·ªânh thanh scrollbar trong dark mode */
    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--text-muted);
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-secondary);
    }
    
    /* ƒêi·ªÅu ch·ªânh hover cho table rows */
    tr:hover {
      background-color: var(--bg-tertiary);
    }
    
    /* ƒêi·ªÅu ch·ªânh b√≥ng cho container */
    .container {
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    /* ƒêi·ªÅu ch·ªânh m√†u cho c√°c badge */
    .badge {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    /* ƒêi·ªÅu ch·ªânh m√†u cho empty state */
    #empty-state {
      background: var(--bg-secondary);
    }
  }
  
  /* ========== REDUCED MOTION SUPPORT ========== */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
    
    .fade-in {
      animation: none;
    }
    
    .badge:hover,
    .map-link:hover,
    .back-button:hover {
      transform: none !important;
    }
  }
  
  /* ========== PRINT STYLES ========== */
  @media print {
    body {
      background: white !important;
      color: black !important;
      padding: 0;
    }
    
    .container {
      box-shadow: none !important;
      border: 1px solid #ccc !important;
      border-radius: 0 !important;
      max-width: 100% !important;
      padding: 10px !important;
    }
    
    .back-button,
    .search-group {
      display: none !important;
    }
    
    table {
      border: 1px solid #ccc;
    }
    
    th, td {
      color: black !important;
      border-color: #ccc !important;
    }
    
    .badge {
      border: 1px solid #ccc !important;
      color: black !important;
      background: white !important;
    }
    
    .map-link {
      color: black !important;
      background: white !important;
      border: 1px solid #ccc !important;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üìç Qu·∫£n l√Ω v·ªã tr√≠ ƒëi·ªÉm gas</h1>
    
    <div class="search-group">
      <input id="search" placeholder="T√¨m ki·∫øm t√™n ƒëi·ªÉm, ƒë·ªãa ch·ªâ ho·∫∑c ghi ch√∫...">
    </div>
    
    <div class="table-container">
      <table id="vitri-table">
        <thead>
          <tr>
            <th>T√™n ƒëi·ªÉm</th>
            <th>ƒê·ªãa ch·ªâ</th>
            <!-- ·∫®n ho√†n to√†n c·ªôt ghi ch√∫ -->
            <th class="col-ghichu" style="display:none;">Ghi ch√∫</th>
            <th>T·ªça ƒë·ªô GPS</th>
            <th>M·ªü b·∫£n ƒë·ªì</th>
          </tr>
        </thead>
        <tbody id="table-body">
          <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
        </tbody>
      </table>
    </div>
    
    <div id="empty-state">
      <h3>üì≠ Ch∆∞a c√≥ v·ªã tr√≠ n√†o ƒë∆∞·ª£c l∆∞u</h3>
      <p>H√£y s·ª≠ d·ª•ng ch·ª©c nƒÉng l∆∞u v·ªã tr√≠ GPS tr√™n trang ch√≠nh ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
      <p style="font-size: 0.9rem; margin-top: 10px;">
        <em>L∆∞u √Ω: Ch·ªâ nh·ªØng ƒëi·ªÉm gas c√≥ t·ªça ƒë·ªô GPS m·ªõi hi·ªÉn th·ªã ·ªü ƒë√¢y.</em>
      </p>
    </div>
  </div>

  <!-- N√∫t quay v·ªÅ trang ch√≠nh -->
  <a href="index.html" class="back-button" title="Quay v·ªÅ trang ch√≠nh" aria-label="Quay v·ªÅ trang ch√≠nh">
    ‚Üê
  </a>

<script>
// S·ª≠ d·ª•ng c√πng URL v·ªõi file index.html
const scriptURL = 'https://script.google.com/macros/s/AKfycbyRnnoEd2BnD7u1pXHER17Cv95BN9Z77yUeO6oR7CFRtbUqd-SiVJqBv5ENYyARwX77fw/exec';
let allData = [];
let vitriData = [];
let currentFilteredData = [];

// H√†m tr√≠ch xu·∫•t GPS t·ª´ ghi ch√∫
function extractGPS(note) {
  if (!note) return null;
  
  // T√¨m ƒë·ªãnh d·∫°ng [GPS: lat, lng]
  const match = note.match(/\[GPS:\s*([\d.]+),\s*([\d.]+)\]/);
  if (match) {
    const lat = parseFloat(match[1]);
    const lng = parseFloat(match[2]);
    if (!isNaN(lat) && !isNaN(lng)) {
      return { 
        lat: lat.toFixed(6), 
        lng: lng.toFixed(6),
        rawLat: lat,
        rawLng: lng
      };
    }
  }
  return null;
}

// H√†m hi·ªÉn th·ªã d·ªØ li·ªáu v·ªã tr√≠
function displayVitri(data) {
  const tbody = document.getElementById('table-body');
  const emptyState = document.getElementById('empty-state');
  
  if (!data || data.length === 0) {
    tbody.innerHTML = '';
    emptyState.style.display = 'block';
    return;
  }
  
  tbody.innerHTML = '';
  let count = 0;
  
  data.forEach(row => {
    const gps = extractGPS(row.ghi_chu);
    if (!gps) return; // Ch·ªâ hi·ªÉn th·ªã nh·ªØng ƒëi·ªÉm c√≥ GPS
    
    count++;
    const tr = document.createElement('tr');
    tr.className = 'fade-in';
    
    // ƒê·ªãnh d·∫°ng hi·ªÉn th·ªã t√™n ƒëi·ªÉm v√† ƒë·ªãa ch·ªâ
    const tenDiem = row.ten_diem || 'Ch∆∞a c√≥ t√™n';
    const diaChi = row.dia_chi || 'Ch∆∞a c√≥ ƒë·ªãa ch·ªâ';
    
    tr.innerHTML = `
      <td>
        <div style="font-weight: 600; color: var(--text-primary);">${tenDiem}</div>
      </td>
      <td>
        <div style="color: var(--text-secondary); font-size: 0.9rem;">${diaChi}</div>
      </td>
      <td class="col-ghichu" style="display:none;">${row.ghi_chu || ''}</td>
      <td>
        <div class="badge" title="${gps.lat}, ${gps.lng}" onclick="copyToClipboard('${gps.lat}, ${gps.lng}')">
          ${gps.lat}, ${gps.lng}
        </div>
      </td>
      <td>
        <a class="map-link" href="https://maps.google.com/?q=${gps.rawLat},${gps.rawLng}" target="_blank" title="M·ªü Google Maps">
          üó∫Ô∏è <span style="font-size: 0.85rem;">Maps</span>
        </a>
      </td>
    `;
    
    tbody.appendChild(tr);
  });
  
  if (count === 0) {
    emptyState.style.display = 'block';
    emptyState.innerHTML = `
      <h3>üì≠ Kh√¥ng t√¨m th·∫•y v·ªã tr√≠</h3>
      <p>Kh√¥ng c√≥ ƒëi·ªÉm gas n√†o c√≥ t·ªça ƒë·ªô GPS trong d·ªØ li·ªáu hi·ªán t·∫°i.</p>
      <p style="font-size: 0.9rem; margin-top: 10px;">
        <em>L∆∞u √Ω: Ch·ªâ nh·ªØng ƒëi·ªÉm gas c√≥ t·ªça ƒë·ªô GPS m·ªõi hi·ªÉn th·ªã ·ªü ƒë√¢y.</em>
      </p>
    `;
  } else {
    emptyState.style.display = 'none';
  }
  
  // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng k·∫øt qu·∫£
  updateResultCount(count);
}

// H√†m c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng k·∫øt qu·∫£
function updateResultCount(count) {
  const header = document.querySelector('h1');
  if (header) {
    const currentText = header.textContent.replace(/\(\d+\)$/, '').trim();
    header.textContent = count > 0 ? `${currentText} (${count})` : currentText;
  }
}

// H√†m l·ªçc d·ªØ li·ªáu theo t·ª´ kh√≥a t√¨m ki·∫øm
function filterVitri() {
  const searchInput = document.getElementById('search');
  const query = searchInput.value.toLowerCase().trim();
  
  if (!query) {
    currentFilteredData = vitriData;
    displayVitri(vitriData);
    return;
  }
  
  const filtered = vitriData.filter(row => {
    // T√¨m ki·∫øm trong t√™n ƒëi·ªÉm, ƒë·ªãa ch·ªâ v√† ghi ch√∫
    const searchableText = `
      ${row.ten_diem || ''}
      ${row.dia_chi || ''}
      ${row.ghi_chu || ''}
    `.toLowerCase();
    
    return searchableText.includes(query);
  });
  
  currentFilteredData = filtered;
  displayVitri(filtered);
}

// H√†m sao ch√©p v√†o clipboard
async function copyToClipboard(text) {
  try {
    if (navigator.clipboard && window.isSecureContext) {
      await navigator.clipboard.writeText(text);
      showToast(`‚úÖ ƒê√£ sao ch√©p: ${text}`);
    } else {
      // Fallback cho c√°c tr√¨nh duy·ªát c≈©
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      document.body.appendChild(textArea);
      textArea.select();
      const success = document.execCommand('copy');
      document.body.removeChild(textArea);
      
      if (success) {
        showToast(`‚úÖ ƒê√£ sao ch√©p: ${text}`);
      } else {
        showToast('‚ùå Kh√¥ng th·ªÉ sao ch√©p v√†o clipboard', 'error');
      }
    }
  } catch (err) {
    console.error('L·ªói khi sao ch√©p:', err);
    showToast('‚ùå L·ªói khi sao ch√©p', 'error');
  }
}

// H√†m hi·ªÉn th·ªã th√¥ng b√°o toast
function showToast(message, type = 'success') {
  // T·∫°o toast element n·∫øu ch∆∞a c√≥
  let toast = document.getElementById('toast-notification');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'toast-notification';
    toast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'success' ? 'var(--secondary)' : 'var(--danger)'};
      color: var(--text-inverse);
      padding: 12px 20px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      opacity: 0;
      transform: translateY(-20px);
      transition: opacity 0.3s, transform 0.3s;
      font-weight: 500;
      border: 1px solid ${type === 'success' ? 'var(--secondary-dark)' : 'var(--danger-dark)'};
    `;
    document.body.appendChild(toast);
  }
  
  toast.textContent = message;
  toast.style.opacity = '1';
  toast.style.transform = 'translateY(0)';
  
  // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(-20px)';
    setTimeout(() => {
      if (toast.parentNode) {
        document.body.removeChild(toast);
      }
    }, 300);
  }, 3000);
}

// H√†m t·∫£i d·ªØ li·ªáu t·ª´ Google Sheets
async function taiDuLieu() {
  try {
    console.log('ƒêang t·∫£i d·ªØ li·ªáu v·ªã tr√≠ t·ª´ Google Sheets...');
    
    // Th√™m timestamp ƒë·ªÉ tr√°nh cache
    const url = scriptURL + '?t=' + Date.now();
    const response = await fetch(url);
    
    if (!response.ok) {
      throw new Error(`L·ªói HTTP! status: ${response.status}`);
    }
    
    const text = await response.text();
    let data;
    
    try {
      data = JSON.parse(text);
    } catch (parseError) {
      console.error('L·ªói parse JSON:', parseError);
      // Th·ª≠ fix n·∫øu c√≥ v·∫•n ƒë·ªÅ v·ªõi JSON
      const fixedText = text.trim();
      if (fixedText.startsWith('[') && fixedText.endsWith(']')) {
        data = JSON.parse(fixedText);
      } else {
        throw new Error('D·ªØ li·ªáu kh√¥ng ph·∫£i JSON h·ª£p l·ªá');
      }
    }
    
    if (!Array.isArray(data)) {
      throw new Error('D·ªØ li·ªáu kh√¥ng ph·∫£i l√† m·∫£ng');
    }
    
    allData = data;
    console.log(`ƒê√£ t·∫£i ƒë∆∞·ª£c ${allData.length} b·∫£n ghi t·ª´ Google Sheets`);
    
    // L·ªçc ch·ªâ nh·ªØng ƒëi·ªÉm c√≥ GPS trong ghi ch√∫
    vitriData = allData.filter(row => {
      const hasGPS = extractGPS(row.ghi_chu);
      return hasGPS;
    });
    
    // Lo·∫°i b·ªè c√°c b·∫£n ghi tr√πng l·∫∑p (c√πng t√™n ƒëi·ªÉm v√† GPS)
    const uniqueMap = new Map();
    vitriData.forEach(row => {
      const gps = extractGPS(row.ghi_chu);
      if (gps) {
        const key = `${row.ten_diem || ''}_${gps.lat}_${gps.lng}`;
        if (!uniqueMap.has(key)) {
          uniqueMap.set(key, row);
        }
      }
    });
    
    vitriData = Array.from(uniqueMap.values());
    currentFilteredData = vitriData;
    
    console.log(`T√¨m th·∫•y ${vitriData.length} ƒëi·ªÉm gas c√≥ t·ªça ƒë·ªô GPS`);
    displayVitri(vitriData);
    
    if (vitriData.length === 0) {
      showToast('‚ö†Ô∏è Kh√¥ng c√≥ ƒëi·ªÉm gas n√†o c√≥ t·ªça ƒë·ªô GPS', 'warning');
    } else {
      showToast(`‚úÖ ƒê√£ t·∫£i ${vitriData.length} v·ªã tr√≠ c√≥ GPS`);
    }
    
  } catch (error) {
    console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
    
    const emptyState = document.getElementById('empty-state');
    emptyState.style.display = 'block';
    emptyState.innerHTML = `
      <h3>‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu</h3>
      <p>Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn ngu·ªìn d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i sau.</p>
      <p style="font-size: 0.9rem; margin-top: 10px;">
        <em>Chi ti·∫øt l·ªói: ${error.message}</em>
      </p>
      <button onclick="taiDuLieu()" style="
        margin-top: 15px;
        padding: 8px 16px;
        background: var(--primary);
        color: var(--text-inverse);
        border: none;
        border-radius: var(--radius-sm);
        cursor: pointer;
        font-weight: 500;
      ">
        üîÑ Th·ª≠ l·∫°i
      </button>
    `;
    
    showToast('‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ Google Sheets!', 'error');
  }
}

// Th√™m s·ª± ki·ªán cho √¥ t√¨m ki·∫øm
document.getElementById('search').addEventListener('input', filterVitri);

// Th√™m s·ª± ki·ªán Enter ƒë·ªÉ t√¨m ki·∫øm
document.getElementById('search').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    filterVitri();
  }
});

// Kh·ªüi ƒë·ªông khi trang ƒë∆∞·ª£c t·∫£i
document.addEventListener('DOMContentLoaded', function() {
  console.log('=== TRANG QU·∫¢N L√ù V·ªä TR√ç ƒêANG KH·ªûI ƒê·ªòNG ===');
  
  // T·∫£i d·ªØ li·ªáu ngay khi trang load
  taiDuLieu();
  
  // Th√™m s·ª± ki·ªán click cho c√°c h√†ng trong b·∫£ng
  document.addEventListener('click', function(e) {
    // N·∫øu click v√†o badge t·ªça ƒë·ªô
    if (e.target.classList.contains('badge')) {
      const text = e.target.getAttribute('title') || e.target.textContent;
      copyToClipboard(text.trim());
    }
  });
  
  // T·ª± ƒë·ªông focus v√†o √¥ t√¨m ki·∫øm
  setTimeout(() => {
    const searchInput = document.getElementById('search');
    if (searchInput) {
      searchInput.focus();
    }
  }, 500);
});

// Th√™m s·ª± ki·ªán cho n√∫t refresh khi online
window.addEventListener('online', function() {
  console.log('K·∫øt n·ªëi m·∫°ng ƒë√£ ƒë∆∞·ª£c kh√¥i ph·ª•c, t·∫£i l·∫°i d·ªØ li·ªáu...');
  taiDuLieu();
});
</script>
</body>
</html>